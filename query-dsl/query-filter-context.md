# 查询和过滤上下文

## 关联分数

默认情况下，Elasticsearch通过**相关性得分**对匹配的搜索结果进行排序，该得分衡量每个文档与查询的匹配程度。
相关性分数是一个正浮点数，在搜索API的_score元字段中返回。_score越高，文档越相关。
虽然每种查询类型可以不同地计算相关性分数，但是分数计算还取决于查询子句是在查询上下文中还是在过滤器上下文中运行。

### 查询上下文

在查询上下文中，查询子句回答以下问题：“此文档与该查询子句的匹配程度如何？”除了确定文档是否匹配之外，
查询子句还计算_score元字段中的相关性得分。
只要将查询子句传递给查询参数（例如[`搜索API`](https://www.xxx.com)中的查询参数），查询上下文就有效。

## 筛选上下文

在过滤器上下文中，查询子句回答问题“此文档是否与此查询子句匹配？”答案是简单的“是”或“否”，即不计算分数。
过滤器上下文主要用于过滤结构化数据，例如

- 此时间戳记是否在2015年到2016年之间？
- 状态字段设置为“已发布”吗？

常用过滤器将由Elasticsearch自动缓存，以提高性能。

每当将查询子句传递到过滤器参数（例如[`bool`](https://www.xxx.com)查询中的`filter`或`must_not`参数，
[`constant_score`](https://www.xxx.com)查询中的[`filter`](https://www.xxx.com)参数或过滤器聚合）时，
过滤器上下文即生效。

## 示例：

以下是在`搜索API`的查询和过滤器上下文中使用的查询子句的示例。此查询将匹配满足以下所有条件的文档：

- 标题字段包含单词`search`。
- 内容字段包含单词`elasticsearch`。
- 状态字段包含`published`的确切单词。
- `publish_date`字段包含从2015年1月1日开始的日期。

```
GET /_search
{
  "query": { 
    "bool": { 
      "must": [
        { "match": { "title":"Search"}},
        { "match": { "content": "Elasticsearch" }}
      ],
      "filter": [ 
        { "term":  { "status": "published" }},
        { "range": { "publish_date": { "gte": "2015-01-01" }}}
      ]
    }
  }
}
```